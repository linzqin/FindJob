# OWASP Top 10(OWASP，Open Web Application Security Project)

- 开放web应用程序安全项目公开的10个最关键的web应用程序安全漏洞列表。

#### 2021

1. **失效的访问控制**
	- 常见的CWE包括：将敏感信息泄露给未经授权的参与者、通过发送的数据泄露敏感信息、跨站请求伪造（csrf）
  - 每个用户在权限之内操作。失败的访问控制会导致未经授权的信息泄露、修改、销毁等；或在用户权限之外执行业务功能。
   - 常见的访问控制脆弱点：违反最小特权或默认拒绝原则、特权提升、修改url（参数修改或强制浏览）等绕过访问控制检查。
   - 预防：除公共资源默认拒绝访问、使用一次性的访问控制机制、建立访问控制模型强制执行所有权记录等。
2. **加密机制失效**
   - 是否明文、密钥强度怎么样
   - 预防：不必要的敏感数据尽快清除、加密存储敏感、不用传统的ftp协议传输敏感
3. **注入攻击**
   - 没验证过滤清洗用户提供的数据、直接将动态查询或无上下文感知转移的非参数化调用在解释器种使用
   - 使用安全的api（解释器原因）、肯定或白名单服务器输入验证、查询中使用LIMIT或其他sql控件以确保不会大量披露
4. **不安全的设计**
   - 需求和资源管理、安全设计、安全开发生命周期
   - 预防：建立安全的开发周期、使用安全设计模式的库、分层设计
5. **安全配置错误**
   - 缺少安全加固、权限配置错误、安装了不必要的功能、默认账户密码、升级的系统没有开启最新的安全特性、应用软件已过期
   - 预防：加固过程、搭建最小化平台、最新的安全说明更新补丁。
6. **自带缺陷和过时的组件**
   - 是否知道所用组件版本信息、是否不再支持或过时、没有定期漏扫或查看组件安全公告
   - 预防：移除不使用的依赖功能组件等、仅从官方处获取组件、监控那些不再维护的或不再发布安全补丁的组件和库
7. **身份识别和身份验证错误**
   - 允许暴力或自动化攻击、允许预设脆弱常见密码、脆弱无效的认证资讯回复或忘记密码的流程、使用明文或脆弱hash密码、url中泄露session、没有正确注销sessionID
   - 预防：多因素认证防止自动化撞库或暴力破解、不交付或部署任何预设认证凭证、限制或增加失败尝试的延迟
8. **软件和数据完整性故障**
   - 预防：验证软件和数据的来源且违背修改、确保库与依赖项目在使用受信任的存储库、确保使用安全工具验证组件是否存在已知漏洞。
9. **安全日志和监控故障**
   - 需要审计的事件未记录、日志只存在本地、警报阈值和响应升级过程不到位或无效。无法实时检测升级警报
   - 预防：确保日志能被记录、确保日志是以方便使用的格式生成的、确保高价值交易被完整记录
10. **服务器请求伪造SSRF**
    - 服务器过于信任用户的url，没有做足够的检测或地址限制，使其可将服务器作为跳板机，访问内网或其他服务器。
    - 服务器提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤和限制。
    - **常用来进行**：端口扫描、攻击内网存在漏洞的服务、攻击web应用进行指纹识别及其中的漏洞、php安装了expect扩展，可以执行系统命令
    - **预防**：限制请求端口只能为web端口，只允许访问http和https请求、限制不能访问内网的ip防止对内网造成攻击、屏蔽返回的详细信息。
    - **无回显时怎么探测内网信息**：dnslog。把服务器返回的结果放在域名中，然后读dbs解析时的日志，获取信息。

#### 2017

- **injection注入攻击**
  - 当不受信任的数据作为命令或查询的一部分发送到解释器时就会发生。
- **敏感数据泄露**
- **XXE XML外部实体注入**
  - 应用程序解析xml输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、攻击内网网站、发起dos攻击等危害。
- **XSS 跨站脚本攻击**
  - 预期外脚本语言执行
  - **防御策略**：前端过滤字符、后端白名单、设置http-only（放置客户端脚本访问cookie）、防止cookie被读取、waf
  - **存储型xss在纯内网的环境怎么利用**
    - 本质是任意代码执行，可以修改网站页面，甚至可以扫描端口
  - **DOM型和一般的差别**：基于文档对象模型的一种漏洞，是在js脚本动态执行的过程中产生的
    - **存储型**：存在数据库，一般信息修改添加的地方。经过服务器
    - **反射性**：不存是数据库，一般在url中，需要用户去点击
  - **csrf 跨站请求伪造脚本攻击**
    - 利用用户cookie伪造用户请求发送到服务器上。攻击者不能获取信息，因为是浏览器发送请求给网站服务器。
    - **如果是post请求如何攻击**：隐藏表单，自动提交
    - **没有表单只是post请求**：ajax发送post请求
    - **防范**：refer检测、添加token、二次验证
  - **xss csrf ssrf 的区别**
- **不安全的反序列化**
  - 通常会导致远程代码执行
  - 序列化：对象变字符串。反序列化：字符串变对象。
  - **php反序列化**：①无类：多走一步，将输入变成经反序列化能成为攻击代码的数据。②有类：使用魔术方法，只要使用了就会调用
  - **java反序列化**：对象--字节流
  - **shrio反序列化**：
    - apache shrio提供rememeber me功能。
    - 正常用户登录后，通过加密和编码，生成一个cookie。服务器拿到cookie进行base64解密，再AES解密，最后进行反序列化校验。
    - 由于AES使用的是硬编码，一般还会使用默认密钥，因此攻击者可以进行cookie重构。先构造恶意代码，再序列化，再AES加密（已经得到密钥了），再base64加密形成新的cookie。服务器会进行逆流程，触发恶意代码。

#### 2013之前

- **不安全的密码存储**
  - 不加密处理或强度不够
- **不安全的对象引用**
  - 已经授权的用户，通过更改访问时的参数，从而访问到了原本其没有得到授权的对象
- **csrf**